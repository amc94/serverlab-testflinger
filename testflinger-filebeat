FROM debian:buster
# FROM prima/filebeat:6

# install deps & cleanup
RUN apt-get update \
  && apt-get install -y \
    --no-install-recommends \
    wget \
    bash \
    bash-completion \
    net-tools \
    curl \
    gnupg \
    apt-transport-https

# RUN wget --no-check-certificate -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch \
#   | apt-key add -
# RUN echo "deb https://artifacts.elastic.co/packages/7.x/apt stable main" \
#   | tee -a /etc/apt/sources.list.d/elastic-7.x.lis
# RUN apt-get update && apt-get -y install filebeat

WORKDIR /opt
RUN curl -L -O -k \
  https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.4.0-linux-x86_64.tar.gz
RUN tar xzvf filebeat-7.4.0-linux-x86_64.tar.gz

WORKDIR /opt/filebeat-7.4.0-linux-x86_64
RUN rm ./filebeat.yml
COPY ./elk/filebeat.yml ./filebeat.yml

RUN chown root ./filebeat.yml \
  && chmod go-w ./filebeat.yml

RUN ./filebeat modules enable system redis elasticsearch
