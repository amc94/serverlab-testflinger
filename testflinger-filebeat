# FROM docker.elastic.co/beats/filebeat:7.9.2
FROM prima/filebeat:6

COPY ./elk/filebeat.yml /filebeat.yml
# COPY ./elk/fields.yml /fields.yml
# RUN mkdir /config
# COPY ./elk/filebeat.yml /config/filebeat.yml
# COPY ./elk/fields.yml /config/fields.yml

RUN mkdir /module/elasticsearch \
  && mkdir /module/redis \
  && mkdir /module/system
ADD ./elk/filebeat_module/elasticsearch /module/elasticsearch
ADD ./elk/filebeat_module/redis /module/redis
ADD ./elk/filebeat_module/system /module/system

RUN chown root /filebeat.yml \
  # && chown root /fields.yml \
  && chmod go-w /filebeat.yml \
  # && chmod go-w /fields.yml
# RUN chown root /config/filebeat.yml \
#   && chown root /config/fields.yml \
#   && chmod go-w /config/filebeat.yml \
#   && chmod go-w /config/fields.yml

# RUN cp /config/* /

# RUN filebeat -c /config/filebeat.yml modules enable system redis elasticsearch