FROM python:3.8-slim-buster

# REST api
EXPOSE 8000

# install deps
RUN apt-get update \
  && apt-get install -y \
    --no-install-recommends \
    build-essential \
    curl \
    git \
    wget \
    python3 \
    python3-dev \
    python3-pip \
    python3-requests \
    python3-click

# facilitate logging
RUN mkdir -p /var/log/testflinger \
  && chmod 777 /var/log/testflinger

# clone src
WORKDIR /data
RUN git clone https://git.launchpad.net/testflinger

# run setup
WORKDIR /data/testflinger
RUN ./setup.py install

# copy tf config files
COPY ./code/testflinger.conf /data/testflinger
